<!doctype html><html lang=fr dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="fr-FR"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Implementer un appel système pour OpenBSD &#183; poolp.org</title>
<meta name=title content="Implementer un appel système pour OpenBSD &#183; poolp.org"><meta name=keywords content="kernel,C,OpenBSD,"><link rel=canonical href=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/><link type=text/css rel=stylesheet href=/css/main.bundle.min.aae4ab0954fc7f7114dd14fabe5a76a6cf645fd2fabe5cef37d61d1fd5d62e9e65e2793e72c6cc5d3da9792419995b3533cbbdc333bc3897f31f77d72a4a27f7.css integrity="sha512-quSrCVT8f3EU3RT6vlp2ps9kX9L6vlzvN9YdH9XWLp5l4nk+csbMXT2peSQZmVs1M8u9wzO8OJfzH3fXKkon9w=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.cab249ec2f87c8efdec1594e650838fcb9837dff59bf06c71a79fe5e0a7a0f19fcca05399fe094d181e68eb57354ed0b2328cfe53accab2b24257f0beda841a9.js integrity="sha512-yrJJ7C+HyO/ewVlOZQg4/LmDff9ZvwbHGnn+Xgp6Dxn8ygU5n+CU0YHmjrVzVO0LIyjP5TrMqyskJX8L7ahBqQ==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/"><meta property="og:site_name" content="poolp.org"><meta property="og:title" content="Implementer un appel système pour OpenBSD"><meta property="og:description" content="TL;DR: J’ai retrouvé une copie imprimée d’un devoir que j’ai eu à faire en 2005, quand j’étais encore étudiant, pour implémenter un appel système sous OpenBSD et Linux."><meta property="og:locale" content="fr_FR"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-25T23:22:00+02:00"><meta property="article:modified_time" content="2023-07-25T23:22:00+02:00"><meta property="article:tag" content="Kernel"><meta property="article:tag" content="C"><meta property="article:tag" content="OpenBSD"><meta property="og:image" content="https://poolp.org/posts/2023-07-05/implementing-a-system-call-for-openbsd/feature.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://poolp.org/posts/2023-07-05/implementing-a-system-call-for-openbsd/feature.png"><meta name=twitter:title content="Implementer un appel système pour OpenBSD"><meta name=twitter:description content="TL;DR: J’ai retrouvé une copie imprimée d’un devoir que j’ai eu à faire en 2005, quand j’étais encore étudiant, pour implémenter un appel système sous OpenBSD et Linux."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Implementer un appel système pour OpenBSD","headline":"Implementer un appel système pour OpenBSD","abstract":"TL;DR: J\u0026rsquo;ai retrouvé une copie imprimée d\u0026rsquo;un devoir que j\u0026rsquo;ai eu à faire en 2005, quand j\u0026rsquo;étais encore étudiant, pour implémenter un appel système sous OpenBSD et Linux.","inLanguage":"fr-FR","url":"https:\/\/poolp.org\/fr\/posts\/2023-07-25\/implementer-un-appel-syst%C3%A8me-pour-openbsd\/","author":{"@type":"Person","name":""},"copyrightYear":"2023","dateCreated":"2023-07-25T23:22:00\u002b02:00","datePublished":"2023-07-25T23:22:00\u002b02:00","dateModified":"2023-07-25T23:22:00\u002b02:00","keywords":["kernel","C","OpenBSD"],"mainEntityOfPage":"true","wordCount":"3387"}]</script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/custom.css><script>for(var elements=document.querySelectorAll(".discord-dialog__close-button, .discord-dialog"),i=0;i<elements.length;i++)elements[i].addEventListener("click",function(){toggle(".discord-dialog")})</script><style>@import "https://fonts.cdnfonts.com/css/whitney-2";.discord-dialog *,.discord-dialog :after,.discord-dialog :before{box-sizing:inherit}.discord-dialog a{text-decoration:none}@keyframes discord-dialog__transition{0%{opacity:0;transform:translateY(16px)}100%{opacity:1;transform:translateY(0)}}.discord-dialog{-webkit-tap-highlight-color:transparent;box-sizing:border-box;display:none;z-index:2147483647;position:fixed;max-width:288px;right:0;bottom:0;margin:18px;border-radius:10px;font-family:Whitney,sans-serif;background:#2e3136;color:#72767d;box-shadow:0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12),0 8px 10px -5px rgba(0,0,0,.4);transition:opacity .3s cubic-bezier(.25,.8,.25,1),transform .3s cubic-bezier(.25,.8,.25,1);animation:discord-dialog__transition .2s}.discord-dialog--active{display:block}.discord-dialog__container{font-size:14px;line-height:1.2;color:#99aab5;padding:8px 28px 28px}.discord-dialog__logo{display:none;width:auto;margin-top:5px;height:24px}.discord-dialog__logo path{fill:#fff}.discord-dialog__close-button{position:absolute;right:0;padding:16px;cursor:pointer}.discord-dialog__close-button svg{height:20px;width:20px}.discord-dialog__close-button svg path{fill:#ccc}.discord-dialog__close-button:hover{opacity:.8}.discord-dialog__close-button:active{opacity:.4}.discord-dialog__footer{padding:10px 20px}.discord-dialog__guild-icon{border-radius:50%;width:64px;display:block;height:auto;margin:16px 0}.discord-dialog__guild{font-size:24px;line-height:30px;margin-bottom:12px;font-weight:700;color:#fff}.discord-dialog__btn{background:#7289da;color:#fff;text-align:center;display:block;border-radius:1px;margin:8px;font-size:16px;line-height:24px;border-radius:3px;text-align:center;padding:12px 16px;position:relative;top:-6px;box-shadow:0 2px 4px rgba(0,0,0,.3);transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1)}.discord-dialog__btn:hover{background:#8095de}.discord-dialog__btn:active{background:#677bc4}.discord-dialog__explainer{display:block;margin:2px 8px;color:#7289da;font-size:12px;text-align:right;top:-6px}.discord-dialog__explainer:hover{opacity:.8}.discord-dialog__explainer:active{opacity:.6}.discord-button{-webkit-tap-highlight-color:transparent;box-sizing:border-box;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);position:fixed;bottom:0;right:0;z-index:50;margin:23.5px;padding:15.5px;border-radius:50%;background:#7289da;cursor:pointer;transition:box-shadow .3s cubic-bezier(.25,.8,.25,1),background .3s cubic-bezier(.25,.8,.25,1);display:flex;text-align:center;align-items:center;justify-content:center}.discord-button svg{height:28px;width:28px;transition:background .3s cubic-bezier(.25,.8,.25,1)}.discord-button svg path{fill:#fff}.discord-button:hover{box-shadow:0 3px 6px rgba(0,0,0,.16),0 3px 6px rgba(0,0,0,.23)}.discord-button:hover svg{opacity:.6}.discord-button:active{box-shadow:0 10px 20px rgba(0,0,0,.19),0 6px 6px rgba(0,0,0,.23)}.discord-button:active svg{opacity:.4}</style><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Aller au contenu</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/fr/ class=flex><span class=sr-only>poolp.org</span>
<img src=/img/poolp_bing.png width=512 height=512 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt=poolp.org></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/fr/ class="text-base font-bold text-gray-500 hover:text-gray-900">poolp.org</a><div class="text-sm text-neutral-700 dark:text-neutral-400"><br>Code, build and run.</div></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Github</p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentcolor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementer un appel système pour OpenBSD">FR</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/posts/2023-07-05/implementing-a-system-call-for-openbsd/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementing a system call for OpenBSD">EN</p></a><a href=/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementer un appel système pour OpenBSD">FR</p></a></div></div></div></div><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span><div><div class="cursor-pointer flex items-center nested-menu"><span class=mr-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentcolor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementer un appel système pour OpenBSD">FR</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/posts/2023-07-05/implementing-a-system-call-for-openbsd/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementing a system call for OpenBSD">EN</p></a><a href=/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="Implementer un appel système pour OpenBSD">FR</p></a></div></div></div></div><button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=https://github.com/poolpOrg/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Github</p></a></li></ul><hr><ul class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li class=mb-1><a href=/fr/categories/technologie/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Technologie</p></a></li><li class=mb-1><a href=/fr/categories/musique/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-gray-900" title>Musique</p></a></li></ul></div></label></div></div><div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" style=margin-top:-15px><div class="hidden md:flex items-center space-x-5"><a href=/fr/categories/technologie/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Technologie</p></a><a href=/fr/categories/musique/ class="flex items-center"><p class="text-xs font-light text-gray-500 hover:text-gray-900" title>Musique</p></a></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom" style=background-image:url(/posts/2023-07-05/implementing-a-system-call-for-openbsd/feature_hu9016330602030985569.png)></div><br><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">Message to
<u><b><a href=https://github.com/sponsors/poolpOrg>github</a></b></u> and
<u><b><a href=https://www.patreon.com/gilles>patreon</a></b></u> sponsors:
<b>THANK YOU ❤️</b></span></div><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/fr/>poolp.org</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/fr/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/>Implementer un appel système pour OpenBSD</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Implementer un appel système pour OpenBSD</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-07-25T23:22:00+02:00>25 Janvier 2023</time><span class="px-2 text-primary-500">&#183;</span><span>3387 mots</span><span class="px-2 text-primary-500">&#183;</span><span title="Temps de lecture">16 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/poolpOrg/poolp.org/tree/master/content/posts/2023-07_03/index.fr.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title=Modifier><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentcolor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a></span></div><div class="flex flex-row flex-wrap items-center"><div style=cursor:pointer onclick='window.open("/fr/authors/gilles/","_self")'>Gilles Chehade</div></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/fr/categories/technologie/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Technologie
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/fr/tags/kernel/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kernel
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/fr/tags/c/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">C
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/fr/tags/openbsd/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">OpenBSD</span></span></span></div></div><div class="flex author"><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/img/gilles_hu8275017791684824193.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Auteur</div><a href=https://poolp.org//authors/gilles class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Gilles Chehade</a><div class="text-sm text-neutral-700 dark:text-neutral-400">I&rsquo;m not a cat.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:gilles@poolp.org target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/poolpOrg target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/gilleschehade target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://social.poolp.org/@gilles target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/gilleschehade target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitch.tv/poolporg target=_blank aria-label=Twitch rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M391.17 103.47H352.54v109.7h38.63zM285 103H246.37V212.75H285zM120.83.0 24.31 91.42V420.58H140.14V512l96.53-91.42h77.25L487.69 256V0zM449.07 237.75l-77.22 73.12H294.61l-67.6 64v-64H140.14V36.58H449.07z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">If you like reading articles on this website,
<b>please ❤️</b> consider <b>sharing on social networks</b> to help increase visibility:
<b>this helps buy time for new articles and projects</b> !<section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur LinkedIn" aria-label="Poster sur LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;text=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title=Tweeter aria-label=Tweeter><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Reddit" aria-label="Poster sur Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;description=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Pinterest" aria-label="Poster sur Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;quote=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Facebook" aria-label="Poster sur Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;subject=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Envoyer par email" aria-label="Envoyer par email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section></span></div><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Sommaire</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#avertissement>Avertissement</a></li><li><a href=#quelques-rappels-nécessaires>Quelques rappels nécessaires</a><ul><li><a href=#programme-et-processus>Programme et Processus</a></li><li><a href=#kernel-et-userland>Kernel et userland</a></li><li><a href=#appel-système>Appel système</a></li></ul></li><li><a href=#implémenter-des-appels-système-pour-openbsd>Implémenter des appels système pour OpenBSD</a><ul><li><a href=#pré-requis>Pré-requis</a><ul><li><a href=#utiliser-un-compte-privilégié>Utiliser un compte privilégié</a></li><li><a href=#avoir-les-sources-du-système>Avoir les sources du système</a></li><li><a href=#savoir-comment-rebuilder-un-kernel>Savoir comment rebuilder un kernel</a></li><li><a href=#rebuilder-le-système>Rebuilder le système</a></li></ul></li><li><a href=#appel-système-sans-paramètres-sys_goodbye>Appel système sans paramètres: <code>sys_goodbye()</code></a><ul><li><a href=#implémentation>Implémentation</a></li><li><a href=#description>Description</a></li></ul></li><li><a href=#appel-système-avec-paramètres-sys_showparams>Appel système avec paramètres: <code>sys_showparams()</code></a><ul><li><a href=#implementation>Implementation</a></li><li><a href=#description-1>Description</a></li></ul></li><li><a href=#appel-système-retournant-une-valeur-sys_retparam>Appel système retournant une valeur: <code>sys_retparam()</code></a><ul><li><a href=#implementation-1>Implementation</a></li><li><a href=#description-2>Description</a></li></ul></li><li><a href=#system-call-poking-into-struct-proc-sys_retpid>System call poking into struct proc: <code>sys_retpid()</code></a><ul><li><a href=#implémentation-1>Implémentation</a></li><li><a href=#description-3>Description</a></li><li><a href=#intégration>Intégration</a><ul><li><a href=#intégration-dappels-système-par-linkage-statique>Intégration d&rsquo;appels système par linkage statique</a></li></ul></li></ul></li></ul></li><li><a href=#un-mot-du-futur-2023>Un mot du futur, 2023</a></li><li><a href=#lectures-en-rapport>Lectures en rapport&mldr;</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Sommaire</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#avertissement>Avertissement</a></li><li><a href=#quelques-rappels-nécessaires>Quelques rappels nécessaires</a><ul><li><a href=#programme-et-processus>Programme et Processus</a></li><li><a href=#kernel-et-userland>Kernel et userland</a></li><li><a href=#appel-système>Appel système</a></li></ul></li><li><a href=#implémenter-des-appels-système-pour-openbsd>Implémenter des appels système pour OpenBSD</a><ul><li><a href=#pré-requis>Pré-requis</a><ul><li><a href=#utiliser-un-compte-privilégié>Utiliser un compte privilégié</a></li><li><a href=#avoir-les-sources-du-système>Avoir les sources du système</a></li><li><a href=#savoir-comment-rebuilder-un-kernel>Savoir comment rebuilder un kernel</a></li><li><a href=#rebuilder-le-système>Rebuilder le système</a></li></ul></li><li><a href=#appel-système-sans-paramètres-sys_goodbye>Appel système sans paramètres: <code>sys_goodbye()</code></a><ul><li><a href=#implémentation>Implémentation</a></li><li><a href=#description>Description</a></li></ul></li><li><a href=#appel-système-avec-paramètres-sys_showparams>Appel système avec paramètres: <code>sys_showparams()</code></a><ul><li><a href=#implementation>Implementation</a></li><li><a href=#description-1>Description</a></li></ul></li><li><a href=#appel-système-retournant-une-valeur-sys_retparam>Appel système retournant une valeur: <code>sys_retparam()</code></a><ul><li><a href=#implementation-1>Implementation</a></li><li><a href=#description-2>Description</a></li></ul></li><li><a href=#system-call-poking-into-struct-proc-sys_retpid>System call poking into struct proc: <code>sys_retpid()</code></a><ul><li><a href=#implémentation-1>Implémentation</a></li><li><a href=#description-3>Description</a></li><li><a href=#intégration>Intégration</a><ul><li><a href=#intégration-dappels-système-par-linkage-statique>Intégration d&rsquo;appels système par linkage statique</a></li></ul></li></ul></li></ul></li><li><a href=#un-mot-du-futur-2023>Un mot du futur, 2023</a></li><li><a href=#lectures-en-rapport>Lectures en rapport&mldr;</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-prose"><blockquote><b>TL;DR:</b><br>J&rsquo;ai retrouvé une copie imprimée d&rsquo;un devoir que j&rsquo;ai eu à faire en 2005,
quand j&rsquo;étais encore étudiant,
pour implémenter un appel système sous OpenBSD et Linux.
J&rsquo;ai perdu le fichier source LaTeX alors j&rsquo;ai décidé de le retaper pour en avoir une copie numérique.
À l&rsquo;origine,
l&rsquo;article couvrait les &ldquo;loadable kernel modules&rdquo; (LKM) qui ne font plus partie d&rsquo;OpenBSD,
j&rsquo;ai donc supprimé cette partie.
J&rsquo;ai aussi supprimé la partie Linux parce qu&rsquo;elle ne m&rsquo;intéressait pas à l&rsquo;époque,
que j&rsquo;ai écrit le minimum vital pour mon devoir et que ce n&rsquo;est donc pas très intéressant à lire ;-)</blockquote><h1 class="relative group">Avertissement<div id=avertissement class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#avertissement aria-label=Ancre>#</a></span></h1><p>Le contenu de cet article est basé sur un devoir que j&rsquo;ai rédigé en 2005,
lorsque j&rsquo;étais encore étudiant à Epitech,
donc les choses ont probablement changé et ce n&rsquo;est pas un tutoriel:
s&rsquo;il vous plait,
n&rsquo;écrivez pas d&rsquo;appels systèmes et ne les soumettez pas à OpenBSD&mldr;
sauf si les développeurs d&rsquo;OpenBSD vous ont demandé de le faire et vous ont dit que c&rsquo;était une bonne idée.</p><p>JE LE RÉPÈTE:
N&rsquo;&mldr; IMPLÉMENTEZ&mldr; PAS&mldr; D&rsquo;&mldr; APPELS&mldr; SYSTÈMES&mldr; À&mldr; PARTIR&mldr; DE&mldr; CET&mldr; ARTICLE !</p><p>L&rsquo;article a pour objectif de partager de la connaissance,
et d&rsquo;éviter de perdre quelque chose que j&rsquo;ai écrit et qui n&rsquo;existe plus qu&rsquo;en version papier.
Voyez le comme un vestige archéologique.</p><p>J&rsquo;ai accidentellement leaké une version brouillon de cet article il y a trois ans,
devenue très rapidement populaire suite à un partage sur un site connu&mldr;
avant que je ne la supprime parce que je n&rsquo;avais pas fini de le nettoyer et de mettre cet avertissement.
Cette fois ci,
j&rsquo;ai été plus malin,
j&rsquo;ai tout rédigé avant de faire mon commit.</p><p>J&rsquo;ai fait quelques changements mineurs pour aider à la compréhension,
mais je n&rsquo;ai pas modifié le style d&rsquo;écriture,
vous lisez le moi d&rsquo;il y a 18 ans qui faisait un devoir scolaire.</p><p>Les exemples sont très simples,
ils ne sont pas là pour servir de fondation à vos projets,
mais juste pour aider certains à faire leurs premiers pas sur les marches de la compréhension.
Trouvez les erreurs est un petit cadeau que je vous laisse:
je vous encourage à commenter ou <a href=https://github.com/poolpOrg/poolp.org/tree/master/content/posts/2023-07_03/index.md target=_blank>soumettre des pull requests</a> pour améliorer cet article.</p><h1 class="relative group">Quelques rappels nécessaires<div id=quelques-rappels-n%C3%A9cessaires class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#quelques-rappels-n%C3%A9cessaires aria-label=Ancre>#</a></span></h1><h2 class="relative group">Programme et Processus<div id=programme-et-processus class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#programme-et-processus aria-label=Ancre>#</a></span></h2><p>Les gens utilisent souvent les deux mots de manière interchangeable mais il est important de comprendre la différence entre un programme et un processus,
particulièrement parce que le même programme peut être autorisé à utiliser un appel système dans un processus mais pas dans un autre <strong>(utilisateur privilégié ou non)</strong>,
mais aussi parce que la notion de processus fait partie de l&rsquo;API des appels sytème
<strong>(l&rsquo;interface des appels système prends un pointeur sur une <code>struct proc</code> qui représente un processus)</strong>.</p><p>Un programme est un exécutable qui contient un jeu d&rsquo;instructions qui sont supposées être exécutées et faire quelque chose.
Il réside dans un fichier structuré <strong>(a.out, elf, &mldr;)</strong> dans le système de fichier qui impose des restrictions sur qui peut ou non l&rsquo;exécuter <strong>(permissions et ownership dans un système de fichiers)</strong>.
Un processus est une instance de ce programme,
qui tourne dans un espace mémoire qui lui est propre,
avec ses propres privilèges.</p><p>Si l&rsquo;on prends <code>/bin/ls</code>,
c&rsquo;est un programme qui liste les répertoires et fichiers.
Lorsqu&rsquo;un utilisateur l&rsquo;exécute,
un processus est créé qui va effectivement exécuter ce programme avec les privilèges de l&rsquo;utilisateur,
dans un espace mémoire qui n&rsquo;est pas partagé avec les autres processus.</p><h2 class="relative group">Kernel et userland<div id=kernel-et-userland class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#kernel-et-userland aria-label=Ancre>#</a></span></h2><p>Les systèmes Unix-like ont une architecture où le code est exécuté dans deux zones principales:
le kernel (noyau) et le userland (espace utilisateur).</p><p>Le kernel est en charge de <strong>fournir et limiter l&rsquo;accès aux matériels</strong>,
<strong>imposer des restrictions sur ce qu&rsquo;un programme peut faire</strong>,
et <strong>fournir un espace mémoire virtuel aux programmes</strong> dans lesquels ils peuvent s&rsquo;exécutér.</p><p>Un programme <strong>s&rsquo;exécute en userland</strong> et effectue des opérations sur <strong>une mémoire qui lui est allouée par le kernel durant l&rsquo;initialisation du processus</strong>.
Lorsque le programme doit accéder à un matériel ou a besoin que le kernel fasse une opération qu&rsquo;il n&rsquo;est pas autorisé à faire lui même,
<strong>il demande au kernel de déclencher un appel système</strong>.
L&rsquo;appel système est <strong>une fonction qui fait partie du kernel</strong> et qui s&rsquo;exécute en lui de la part du processus.</p><h2 class="relative group">Appel système<div id=appel-syst%C3%A8me class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#appel-syst%C3%A8me aria-label=Ancre>#</a></span></h2><p><strong>Un appel système est un service fourni par le kernel pour qu&rsquo;un processus userland puisse demander au kernel de faire quelque chose à sa place, généralement quelque chose que le programme useland n&rsquo;est pas capable ou pas autorisé à faire lui même</strong>.</p><p>Du point de vue d&rsquo;un programme,
c&rsquo;est une fonction un peu particulière qu&rsquo;il peut appeler comme n&rsquo;importe quelle autre fonction,
mais qui <strong>ne s&rsquo;exécute pas dans l&rsquo;espace mémoire du processus</strong>.
Un programme connait seulement l&rsquo;interface des appels systèmes mais n&rsquo;a pas accès à leur implémentation,
il peut donc les appeler,
leur passer des paramètres,
obtenir un résultat,
mais ne peut pas inspecter ce qu&rsquo;il se passe à l&rsquo;intérieur de l&rsquo;appel système pendant qu&rsquo;il s&rsquo;exécute.
Il ne peut pas le debugger.</p><p>Ça vient avec des effets de bord.
Côté performances,
un appel système bascule de l&rsquo;exécution en userland à une exécution en kernel qui est plus coûteuse.
Ensuite,
des bugs dans un appel système ont un impact bien différents des bugs dans une fonction:
<strong>une corruption mémoire peut provoquer le crash d&rsquo;un processus, la même corruption mémoire dans un appel système peut provoquer le crash du système</strong>.</p><p>Il y a deux aspects aux appels systèmes:</p><p>L&rsquo;implémentation de l&rsquo;appel systène,
le code effectif de l&rsquo;appel système qui sera exécuté dans le kernel lorsqu&rsquo;il sera appellé,
et l&rsquo;interface de l&rsquo;appel système,
la manière dont l&rsquo;appel système est supposé être appelé depuis une application en userland.</p><p>C&rsquo;est important de différencier les deux comme,
dans OpenBSD,
le prototype pour l&rsquo;implémentation d&rsquo;un appel système ne corresponds pas au prototype de l&rsquo;interface pour le même appel système comme nous allons voir.</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm"><p>Les appels système servent de passerelle entre les applications utilisateur et le noyau du système d&rsquo;exploitation de bas niveau. Ils sont une partie intégrale de l&rsquo;infrastructure d&rsquo;un système d&rsquo;exploitation qui fournit un accès contrôlé aux ressources matérielles, gère les processus et gère les interactions avec le système de fichiers, parmi de nombreuses autres tâches.</p><p>Alors que les systèmes d&rsquo;exploitation sont livrés avec un ensemble standard d&rsquo;appels système, il peut y avoir des cas où vous souhaitez introduire des appels système personnalisés. Ceux-ci pourraient être destinés à du matériel spécialisé, à des exigences de gestion de processus uniques, ou à d&rsquo;autres personnalisations au niveau de l&rsquo;OS qui ne sont pas fournies par les appels système intégrés.</p><p>Comprendre comment ajouter de nouveaux appels système dans un système comme OpenBSD, ouvre donc une porte vers des innovations et des personnalisations au niveau du système.</p></div></div></div></div><h1 class="relative group">Implémenter des appels système pour OpenBSD<div id=impl%C3%A9menter-des-appels-syst%C3%A8me-pour-openbsd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impl%C3%A9menter-des-appels-syst%C3%A8me-pour-openbsd aria-label=Ancre>#</a></span></h1><h2 class="relative group">Pré-requis<div id=pr%C3%A9-requis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pr%C3%A9-requis aria-label=Ancre>#</a></span></h2><h3 class="relative group">Utiliser un compte privilégié<div id=utiliser-un-compte-privil%C3%A9gi%C3%A9 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#utiliser-un-compte-privil%C3%A9gi%C3%A9 aria-label=Ancre>#</a></span></h3><p>Il est évident qu&rsquo;un compte non privilégié n&rsquo;est pas autorisé à modifier le kernel comme il vérifie les permissions sur le système.
Pour cette raison,
il faut nécessairement avoir un compte privilégié au moins pour installer le kernel modifié.</p><h3 class="relative group">Avoir les sources du système<div id=avoir-les-sources-du-syst%C3%A8me class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#avoir-les-sources-du-syst%C3%A8me aria-label=Ancre>#</a></span></h3><p>Les sources du système sont disponibles directemnet depuis le projet OpenBSD.
Pour ce devoir,
nous aurons besoin des archives suivantes:</p><ul><li>src.tar.gz</li><li>srcsys.tar.gz</li></ul><p>Il faudra les extraire à la racine du système:</p><pre tabindex=0><code>% doas tar -C / -zxf src.tar.gz
% doas tar -C / -zxf srcsys.tar.gz
</code></pre><p><strong>(edit: <code>doas</code> remplace maintenant <code>sudo</code>)</strong></p><h3 class="relative group">Savoir comment rebuilder un kernel<div id=savoir-comment-rebuilder-un-kernel class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#savoir-comment-rebuilder-un-kernel aria-label=Ancre>#</a></span></h3><p>Une fois que vous avez accès aux sources du système,
vous pouvez rebuilder un kernel en utilisant les commandes suivantes:</p><pre tabindex=0><code># cd /usr/src/sys/arch/amd64/config
# config GENERIC
# cd ../compile/GENERIC
# make clean depend install
</code></pre><p>Le rebuild ne prends que quelques minutes et une copie de sauvegarde du précedent kernel est faite automatiquement au cas où le nouveau kernel serait instable.</p><h3 class="relative group">Rebuilder le système<div id=rebuilder-le-syst%C3%A8me class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rebuilder-le-syst%C3%A8me aria-label=Ancre>#</a></span></h3><p>Rebuilder le système peut être nécessaire si les changements du kernel affectent des outils userland..
Ce peut être le cas par exemple si vous modifiez la <code>struct proc</code> qui est utilisée par des outils comme <code>ps</code>, <code>top</code> ou <code>uname</code>.
Rebuilder est aussi simple que de taper:</p><pre tabindex=0><code># cd /usr/src
# make build
</code></pre><p>Rebuilder le système est considérablement plus long que pour le kernel et peut prendre de quelques minutes à plusieurs heures selon l&rsquo;architecture.</p><h2 class="relative group">Appel système sans paramètres: <code>sys_goodbye()</code><div id=appel-syst%C3%A8me-sans-param%C3%A8tres-sys_goodbye class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#appel-syst%C3%A8me-sans-param%C3%A8tres-sys_goodbye aria-label=Ancre>#</a></span></h2><p>Pour débuter,
nous allons implémenter l&rsquo;appel système <code>sys_goodbye()</code> qui ne prends aucun paramètre.
Son prototype est:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>goodbye</span>(<span style=color:#8be9fd>void</span>);
</span></span></code></pre></div><h3 class="relative group">Implémentation<div id=impl%C3%A9mentation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impl%C3%A9mentation aria-label=Ancre>#</a></span></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/param.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/systm.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/kernel.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/proc.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/mount.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/syscallargs.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/* displays &#34;Goodbye, cruel world !&#34; on the console */</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>sys_goodbye</span>(<span style=color:#ff79c6>struct</span> proc <span style=color:#ff79c6>*</span>p, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>v, <span style=color:#8be9fd>register_t</span> <span style=color:#ff79c6>*</span>retval)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;Goodbye, cruel world !</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 class="relative group">Description<div id=description class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description aria-label=Ancre>#</a></span></h3><p>Notre premier appel système affiche la phrase &ldquo;Goodbye, cruel world !&rdquo; sur la console.</p><p>Il nous permet de voir que <strong>le prototype de l&rsquo;appel système diffère entre le userland et le kernel</strong>.
OpenBSD fournit <strong>une API unique pour tous les appels systèmes, peu importe le prototype qu&rsquo;ils exposent au userland</strong>.</p><p>Les headers inclus ici sont le set minimal requis pour que l&rsquo;API des appels système fonctionne normalement.
Certains peuvent paraitre inutilisés par notre fonction mais seront utilisé lors du build pour la plomberie interne du kernel.
L&rsquo;appel système ne se limite pas seulement à son implémentation,
certains éléments seront ajoutés par la suite indirectement et automatiquement comme on le verra.</p><p>Ne premier appel système va ignorer ses paramètres (<code>struct proc *</code>, <code>void *v</code> et <code>register_t *retval</code>),
utiliser <code>printf()</code> et retourner 0 pour indiquer à l&rsquo;appelant que l&rsquo;exécution s&rsquo;est bien déroulée.</p><p>Ici, <code>printf()</code> ne doit pas être confondu avec le <code>printf()</code> userland,
le premier est utilisé pour écrire sur la console et non pas sur la sortie standard.</p><h2 class="relative group">Appel système avec paramètres: <code>sys_showparams()</code><div id=appel-syst%C3%A8me-avec-param%C3%A8tres-sys_showparams class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#appel-syst%C3%A8me-avec-param%C3%A8tres-sys_showparams aria-label=Ancre>#</a></span></h2><p>Notre second appel système,
<code>sys_showparams()</code>,
prends un <code>int</code> en paramètre et affiche sa valeur sur la console.
Son prototype est le suivant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>showparams</span>(<span style=color:#8be9fd>int</span> val);
</span></span></code></pre></div><h3 class="relative group">Implementation<div id=implementation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementation aria-label=Ancre>#</a></span></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/param.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/systm.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/kernel.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/proc.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/mount.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/syscallargs.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/* displays value of integer parameter to console */</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>sys_showparams</span>(<span style=color:#ff79c6>struct</span> proc <span style=color:#ff79c6>*</span>p, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>v, <span style=color:#8be9fd>register_t</span> <span style=color:#ff79c6>*</span>retval)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> sys_showparams_args <span style=color:#6272a4>/* {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>		syscallarg(int)		val;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>	} */</span> <span style=color:#ff79c6>*</span>uap <span style=color:#ff79c6>=</span> v;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;showparams(%d)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#50fa7b>SCARG</span>(uap, val));
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 class="relative group">Description<div id=description-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description-1 aria-label=Ancre>#</a></span></h3><p>Contrairement à la précédente,
cette fonction n&rsquo;ignore pas ses paramètres mais en <strong>extraie un paramètre entier passé dans l&rsquo;interface userland</strong>.</p><p>Pour le faire,
l&rsquo;appel système déclare un pointeur vers une <code>struct sys_showparams_args</code> et le fait pointer sur son deuxième paramètre,
<code>void *v</code>.
Il devient clair que ce second paramètre représente d&rsquo;une certaine manière les paramètres que le userland passe à l&rsquo;appel système.</p><p>La définition de <code>struct sys_showparams_args</code> ne fait pas partie de notre implémentation parce qu&rsquo;elle est générée automatiquement au moment du build.
Chacun de ses champs correspond à un paramètre dans l&rsquo;interface userland et la macro <code>SCARG()</code> permet de déréférencer la structure correctement,
sans avoir à s&rsquo;inquiéter de l&rsquo;alignement ou de l&rsquo;endian de l&rsquo;architecture.</p><h2 class="relative group">Appel système retournant une valeur: <code>sys_retparam()</code><div id=appel-syst%C3%A8me-retournant-une-valeur-sys_retparam class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#appel-syst%C3%A8me-retournant-une-valeur-sys_retparam aria-label=Ancre>#</a></span></h2><p>L&rsquo;appel système <code>sys_retparam()</code> prends un paramètre de type <code>int</code> et le retourne s&rsquo;il est inférieur ou égal à 1024, et dans le cas contraire retourne -1, en assignant <code>EINVAL</code> à <code>errno</code>.
Son prototype est similaire à celui de <code>sys_showparams()</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>retparam</span>(<span style=color:#8be9fd>int</span> val);
</span></span></code></pre></div><h3 class="relative group">Implementation<div id=implementation-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementation-1 aria-label=Ancre>#</a></span></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/param.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/systm.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/kernel.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/proc.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/mount.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/syscallargs.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/* returns value of integer parameter if lesser or equal to 1024 */</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>sys_retparam</span>(<span style=color:#ff79c6>struct</span> proc <span style=color:#ff79c6>*</span>p, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>v, <span style=color:#8be9fd>register_t</span> <span style=color:#ff79c6>*</span>retval)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> sys_retparam_args <span style=color:#6272a4>/* {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>		syscallarg(int)		val;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>	} */</span> <span style=color:#ff79c6>*</span>uap <span style=color:#ff79c6>=</span> v;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> val;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	val <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>SCARG</span>(uap, val);
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (val <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>1024</span>)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> (EINVAL);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>*</span>retval <span style=color:#ff79c6>=</span> val;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 class="relative group">Description<div id=description-2 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description-2 aria-label=Ancre>#</a></span></h3><p>les choses sont un petit peu plus complèxes et nous allons devoir plonger sur ce qu&rsquo;il se passe en dehors de la fonction pour comprendre son fonctionnement.</p><p>Le problème est le suivant:
si nous devons retourner 0 en cas de succès et une valeur positive en cas d&rsquo;erreur,
alors comment faire pour avoir un appel système qui retourne une valeur positive en cas de succès ?</p><p>La solution réside dans <strong>le troisième paramètre de notre appel système</strong>.</p><p><strong>La valeur retournée par notre appel système n&rsquo;est pas la valeur retournée par l&rsquo;interface de l&rsquo;appel système pour le userland.</strong> La valeur de retour de notre appel système sert simplement <strong>à déterminer si sont exécution s&rsquo;est déroulée correctement ou assigner <code>errno</code></strong>. La valeur retournée par l&rsquo;interface userland est en réalité placée dans le troisième paramètre de notre implémentation d&rsquo;appel système qui est en rélaité <strong>un tableau de deux registres</strong>.</p><p><strong>Le premier élément de ce tableau représente EAX</strong>,
<strong>il est initialisé à 0 par l&rsquo;API des appels systèmes avant que notre implémentation ne soit appellée et ne puisse le modifier</strong>. Le second élément est rarement utilisé: il sert à resoudre le cas particulier de <code>fork()</code> qui.. retourne <strong>deux valeurs</strong>,
<strong>une pour le processus parent et une pour le processus enfant</strong>.</p><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gilles/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gilles:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm"><p>L&rsquo;article a été écrit pour amd64 où les registres EAX et EDX sont utilisés pour retval,
ce n&rsquo;est évidemment pas le cas pour toutes les autres architectures.</p><p>Pour une meilleur compréhension,
un coup d&rsquo;oeil a <code>/usr/src/sys/amd64/amd64/trap.c</code> (en remplaçant la plateforme par une autre) est utile:
il prépare les paramètres en respectant la convention d&rsquo;appel,
déclenche l&rsquo;interruption d&rsquo;appel système,
fait correspondre les valeurs de registres et d&rsquo;errno aux bonnes structures pour au final donner une impression uniforme au userland sur toutes les architectures.</p></div></div></div></div><h2 class="relative group">System call poking into struct proc: <code>sys_retpid()</code><div id=system-call-poking-into-struct-proc-sys_retpid class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#system-call-poking-into-struct-proc-sys_retpid aria-label=Ancre>#</a></span></h2><p>Notre dernier appel système,
<code>sys_retpid()</code>,
prends un <code>int</code> en paramètre qui va faire retourner à notre fonction le pid du processus si la valeur est 0,
le pid du processus parent si la valeur est 1 et échouer en assignant <code>EINVAL</code> a <code>errno</code> dans les autres cas.
Son prototype est le suivant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>retpid</span>(<span style=color:#8be9fd>int</span> val);
</span></span></code></pre></div><h3 class="relative group">Implémentation<div id=impl%C3%A9mentation-1 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#impl%C3%A9mentation-1 aria-label=Ancre>#</a></span></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/param.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/systm.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/kernel.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/proc.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/mount.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/syscallargs.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * returns current pid if val == 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * returns parent pid if val == 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * return -1 and sets errno to EINVAL otherwise
</span></span></span><span style=display:flex><span><span style=color:#6272a4> */</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>sys_retpid</span>(<span style=color:#ff79c6>struct</span> proc <span style=color:#ff79c6>*</span>p, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>v, <span style=color:#8be9fd>register_t</span> <span style=color:#ff79c6>*</span>retval)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>struct</span> sys_retpid_args <span style=color:#6272a4>/* {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>		syscallarg(int)		val;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>	} */</span> <span style=color:#ff79c6>*</span>uap <span style=color:#ff79c6>=</span> v;
</span></span><span style=display:flex><span>	<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> val;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	val <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>SCARG</span>(uap, val);
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (val <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> val <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>return</span> (EINVAL);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>if</span> (val <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>*</span>retval <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>-&gt;</span>p_pid;
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>		<span style=color:#ff79c6>*</span>retval <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>-&gt;</span>p_pptr<span style=color:#ff79c6>-&gt;</span>p_pid;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff79c6>return</span> (<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gilles/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gilles:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm"><p>Notez que cette fonction peu ou non exploser,
pour de multiples raisons,
et si vous ne comprenez pas pourquoi,
ne copiez-collez pas ce code optimiste qui ne fait pas les vérifications et le locking adéquats.</p><p>Ce commentaire est valide pour toutes les fonctions de cet article.</p></div></div></div></div><h3 class="relative group">Description<div id=description-3 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description-3 aria-label=Ancre>#</a></span></h3><p>Ce dernier appel nous permet d&rsquo;illustrer que la fonction ne s&rsquo;exécute pas en userland mais vraiment dans le kernel,
<strong>il nous permets d&rsquo;accéder à la mémoire en dehors de celle du processus courant</strong>.
Ici,
nous déréférençons la <code>struct proc</code> associée à notre processus mais aussi un pointeur vers une autre <code>struct proc</code>,
nous pouvons utiliser les différentes listes chainées internes à la <code>struct proc</code> pour accéder à des ressources <strong>qui ne sont pas accessibles à notre processus courant en userland</strong>.</p><p>Notez que c&rsquo;est juste un exemple et qu&rsquo;il faut faire bien attention à faire le bon locking requis,
<strong>si l&rsquo;appel système accède à une ressource qui a été libérée, le résultat ne sera pas un crash du processus mais un crash du système</strong>.</p><h3 class="relative group">Intégration<div id=int%C3%A9gration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#int%C3%A9gration aria-label=Ancre>#</a></span></h3><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gilles/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gilles:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm">La version initiale de cette article date de 2005 et présentait le link static et les loadable kernel modules.
<strong>Depuis, l&rsquo;interface LKM a été supprimée d&rsquo;OpenBSD, j&rsquo;ai donc supprimé les parties qui ne présentaient plus d&rsquo;intérêt de nos jours</strong> pour garder l&rsquo;article court.</div></div></div></div><div class=note><div class="flex flex-wrap article border border-neutral-200 dark:border-neutral-700 border-2 rounded-md backdrop-blur"><div class="w-full md:w-auto h-full thumbnail nozoom" style=background-image:url(/authors/gpt-4/profile.png)></div><div class=p-4><div class="items-center text-xl font-semibold"></div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><span class=note-author>@gpt-4:</span></div></div><div class="py-1 max-w-fit prose dark:prose-invert note-comment text-sm"><p>Lors de la mise en œuvre de nouveaux appels système, il est essentiel de faire de la sécurité une priorité dans vos considérations. Par conception, les appels système font le pont entre l&rsquo;espace utilisateur et le noyau, ce qui, s&rsquo;il n&rsquo;est pas correctement géré, peut exposer le système à diverses vulnérabilités.</p><p>Lors de la conception d&rsquo;un appel système, il est crucial de valider toutes les données en entrée. Comme les appels système fonctionnent avec des privilèges de niveau noyau, toutes les données en entrée peuvent potentiellement interagir avec des parties critiques du système, et doivent donc être soigneusement examinées.</p><p>Réfléchissez attentivement aux capacités que votre nouvel appel système devrait avoir. Si un appel système a seulement besoin de lire des données, il ne devrait pas avoir la capacité d&rsquo;écrire des données. Limiter la fonctionnalité au minimum nécessaire peut limiter les dommages potentiels si l&rsquo;appel système est mal utilisé.</p><p>De plus, les problèmes de concurrence peuvent conduire à des conditions de course dans les appels système. Des primitives de synchronisation appropriées doivent être utilisées pour éviter ces scénarios. N&rsquo;oubliez pas, une faille dans un appel système peut mettre en péril la sécurité de l&rsquo;ensemble du système, donc être attentif aux vulnérabilités potentielles est de la plus haute importance.</p><p>Gardez à l&rsquo;esprit qu&rsquo;OpenBSD, comme d&rsquo;autres systèmes de type Unix, suit le principe du privilège minimal, qui suggère qu&rsquo;un processus ne devrait se voir accorder que les privilèges qui sont essentiels à sa fonction. En tant que concepteur d&rsquo;appel système, votre responsabilité est de vous assurer que votre appel système est en accord avec ce principe.</p></div></div></div></div><h4 class="relative group">Intégration d&rsquo;appels système par linkage statique<div id=int%C3%A9gration-dappels-syst%C3%A8me-par-linkage-statique class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#int%C3%A9gration-dappels-syst%C3%A8me-par-linkage-statique aria-label=Ancre>#</a></span></h4><p>Plusieurs fichiers sont en jeu lors d&rsquo;une intégration statique d&rsquo;appel système:</p><ul><li><code>/usr/src/sys/kern.syscalls.master</code> est le fichier principal utilisé pour ajouter un appel système. Il est utilisé pour rebuilder un ensemble de tableaux et de structures internes utilisées par l&rsquo;API des appels systèmes.</li><li><code>/usr/src/sys/kern/syscalls.c</code> contient la liste des appels système.</li><li><code>/usr/src/sys/kern/init_sysent.c</code> contient la table <code>sysent</code>. Chaque élément de la table décrit le nombre de paramètres de l&rsquo;appel système, la structure qui est associée à ces paramètres et la fonction utilisée pour implémenter l&rsquo;appel système.</li><li><code>/usr/src/sys/sys/syscallargs.h</code> contient la définition des structures associées aux appels système.</li><li><code>/usr/src/sys/sys/syscall.h</code> contient les numéros associés à nos appels systèmes représentés par des macros.</li></ul><p>La première étape est d&rsquo;éditer <code>/usr/src/sys/kern.syscalls.master</code> et de trouver un numéro inutilisé d&rsquo;appel système,
ou d&rsquo;en ajouter un s&rsquo;il n&rsquo;y en a pas de disponible.
Le format du fichier est très simple,
il consiste en un numéro d&rsquo;appel système, un type d&rsquo;appel système et un pseudo-prototype.</p><p>Une fois modifié,
les fichiers autogénérés peuvent être reconstruits par ces commandes:</p><pre tabindex=0><code># cd /usr/src/sys/kern
# make init_sysent.c
</code></pre><p>Les fichiers décrits ci-dessus sont reconstruits en prenant en compte les nouveaux appels systèmes et en produisant les structures nécessaires pour leurs paramètres.
Tout ce qu&rsquo;il reste à faire est de reconstruire le kernel après avoir ajouté les fichiers contenant les implémentations de nos appels système.</p><p>Les appels système sont indépendant de l&rsquo;architecture,
leurs implémentations sont placéees dans <code>/usr/src/sys/kern</code>.</p><p>Vous devez ensuite éditer <code>/usr/src/sys/kern/files</code> et y ajouter les lignes suivantes:</p><pre tabindex=0><code>file kern/sys_goodbye.c
file kern/sys_showparam.c
file kern/sys_retparam.c
file kern/sys_retpid.c
</code></pre><p>puis reconstruire le kernel.</p><p>À ce stade,
<strong>une fois le système redémarré sur le nouveau kernel</strong>,
nos appels systèmes sont utilisables par les applications en userland
<strong>qui connaissent leur numéro</strong>
au travers de l&rsquo;appel système <code>syscall()</code>.</p><p>Pour pouvoir les appeler par leur nom,
<strong>vous devrez mettre à jour les fichiers d&rsquo;entêtes</strong> <code>/usr/include/sys/syscall.h</code> et <code>/usr/include/sys/sycallargs.h</code> avec ceux générés durant la phase de <code>make init_sysent.c</code>,
<strong>puis reconstruire la libc après avoir ajouté les fichiers objets</strong> (sans leur préfixe sys_) dans <code>/usr/src/lib/libc/sys/Makefile.inc</code>.</p><p>La libc est reconstruire avec les commandes suivantes:</p><pre tabindex=0><code># cd /usr/src/lib/libc
# make install
</code></pre><p>Les appels systèmes sont immédiatement disponibles sans besoin d&rsquo;un redémarrage du système.</p><h1 class="relative group">Un mot du futur, 2023<div id=un-mot-du-futur-2023 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#un-mot-du-futur-2023 aria-label=Ancre>#</a></span></h1><p>Soyez gentils avec le <code>gilles@</code> de 2005,
n&rsquo;hésitez pas à commenter ou soumettre une pull request pour mettre à jour l&rsquo;article et le moderniser.</p><p>Au cas où vous vous le demandez,
cette interface n&rsquo;est pas exactement celle de NetBSD ou de FreeBSD,
mais les interfaces et structures se ressemblent assez pour pouvoir démarrer.
Si vous le voulez,
je pourrais écrire quelques articles autour de ces sujets à l&rsquo;avenir.</p><p>Au cas où vous vous le demandez aussi,
cette interface ne vous aidera pas du tout pour écrire un appel système sous Linux.
Tout diffère,
depuis la manière dont le code est organisé,
à la manière dont les appels systèmes sont enregistrés,
en passant par la convention d&rsquo;appel.
Les concepts sont les mêmes,
l&rsquo;implémentation et les API sont radicalement différentes.
J&rsquo;ai écrit un devoir là dessus aussi,
implémentant <em>exactement</em> les mêmes appels systèmes en décrivant le cheminement,
mais j&rsquo;ai trouvé ça pénible au possible et ça se ressentait dans l&rsquo;article 😆</p><h1 class="relative group">Lectures en rapport&mldr;<div id=lectures-en-rapport class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#lectures-en-rapport aria-label=Ancre>#</a></span></h1><p>Je recommande la lecture de ces deux livres sur le sujet:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="https://www.amazon.fr/Design-Implementation-FreeBSD-Operating-System/dp/0321968972?_encoding=UTF8&qid=&sr=&linkCode=li3&tag=poolporg07-21&linkId=dd504b9e2ec7d9191f4d7c04278f20ac&language=fr_FR&ref_=as_li_ss_il" target=_blank><img border=0 src=design-and-implementation.jpg></a></td><td><a href="https://www.amazon.fr/dp/B002MZAR6I?&linkCode=li3&tag=poolporg07-21&linkId=5173f2ce403ea0775bb0efcea49902cf&language=fr_FR&ref_=as_li_ss_il" target=_blank><img border=0 src=bsd-rootkits.jpg></td></tr></tbody></table></br></br></div><script>var oid="views_posts/2023-07_03/index.fr.md",oid_likes="likes_posts/2023-07_03/index.fr.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="dark:text-neutral-300 text-sm">You reached the end of this article,
<b>CONGRATULATIONS</b> !<br><br><b>Please ❤️</b> consider <b>sharing on social networks</b> to increase its visibility.<br><br>You can also help by
<b>commenting the article</u></b>,
if only to let me know if you liked it or not !</span></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur LinkedIn" aria-label="Poster sur LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;text=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title=Tweeter aria-label=Tweeter><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Reddit" aria-label="Poster sur Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;description=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Pinterest" aria-label="Poster sur Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;quote=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Poster sur Facebook" aria-label="Poster sur Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;subject=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title="Envoyer par email" aria-label="Envoyer par email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title aria-label><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://poolp.org/fr/posts/2023-07-25/implementer-un-appel-syst%C3%A8me-pour-openbsd/&amp;resubmit=true&amp;title=Implementer%20un%20appel%20syst%c3%a8me%20pour%20OpenBSD" title aria-label><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></section><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=comments><script src=https://giscus.app/client.js data-repo=poolpOrg/poolp.org data-repo-id="MDEwOlJlcG9zaXRvcnkxMjYxODk2MjA=" data-category=Articles data-category-id=DIC_kwDOB4WANM4B-Zf1 data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=light data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/fr/posts/2023-07-04/construire-ma-propre-guitare-partie-3/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Construire ma propre guitare, partie 3</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-07-04T12:31:00+02:00>4 Janvier 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/fr/posts/2023-07-26/construire-ma-propre-guitare-partie-4/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Construire ma propre guitare, partie 4</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-07-26T14:10:00+02:00>26 Janvier 2023</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Faire défiler jusqu'au bas de la page" title="Faire défiler jusqu'au bas de la page">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">Copyright © Gilles Chehade - poolp.org
-
<u><a href=/legal/>Legal notice</a></u></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Propulsé par <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://poolp.org/fr/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Rechercher tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Fermer (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=poolporg data-description="Support me on Buy me a coffee!" data-message="Support me !" data-color=#FFDD00 data-position=left data-x_margin=18 data-y_margin=18></script><div class=discord-button onclick='document.querySelector(".discord-dialog").className="discord-dialog discord-dialog--active"'><svg class="discord-button__icon" viewBox="0 0 24 24"><path d="M22 24l-5.25-5L17.38 21H4.5A2.5 2.5.0 012 18.5V3.5A2.5 2.5.0 014.5 1h15A2.5 2.5.0 0122 3.5V24M12 6.8c-2.68.0-4.56 1.15-4.56 1.15 1.03-.92 2.83-1.45 2.83-1.45l-.17-.17C8.41 6.36 6.88 7.53 6.88 7.53c-1.72 3.59-1.61 6.69-1.61 6.69 1.4 1.81 3.48 1.68 3.48 1.68L9.46 15c-1.25-.27-2.04-1.38-2.04-1.38S9.3 14.9 12 14.9s4.58-1.28 4.58-1.28S15.79 14.73 14.54 15L15.25 15.9S17.33 16.03 18.73 14.22C18.73 14.22 18.84 11.12 17.12 7.53c0 0-1.53-1.17-3.22-1.2l-.17.17s1.8.53 2.83 1.45c0 0-1.88-1.15-4.56-1.15M9.93 10.59c.65.0 1.18.57 1.17 1.27C11.1 12.55 10.58 13.13 9.93 13.13 9.29 13.13 8.77 12.55 8.77 11.86 8.77 11.16 9.28 10.59 9.93 10.59m4.17.0c.65.0 1.17.57 1.17 1.27C15.27 12.55 14.75 13.13 14.1 13.13 13.46 13.13 12.94 12.55 12.94 11.86 12.94 11.16 13.45 10.59 14.1 10.59z"/></svg></div><div class=discord-dialog><div class=discord-dialog__header><a href=https://discordapp.com><svg class="discord-dialog__logo" viewBox="0 0 532 130"><path d="M53.2 20.3H20v37.6l22.1 20V41.4H54c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7H20v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2c0-20.8-16.7-29.9-34.5-29.9zM227.3 80.4V49.6c0-11.1 19.8-13.7 25.8-2.5l18.3-7.5C264.3 23.7 251.1 19 240.2 19c-17.8.0-35.4 10.4-35.4 30.6v30.8c0 20.3 17.6 30.6 35 30.6 11.2.0 24.6-5.6 32-20.1l-19.6-9.1C247.4 94.2 227.3 91.2 227.3 80.4zM166.7 53.8c-6.9-1.5-11.5-4-11.8-8.3.4-10.4 16.3-10.7 25.6-.8l14.7-11.4C186 22 175.6 19 164.8 19c-16.3.0-32.1 9.2-32.1 26.8.0 17.1 13 26.2 27.3 28.4 7.3 1 15.4 3.9 15.2 9-.6 9.6-20.2 9.1-29.1-1.8L132 94.8c8.3 10.7 19.6 16.2 30.2 16.2 16.3.0 34.4-9.5 35.1-26.8C198.3 62.2 182.5 56.7 166.7 53.8zM99.8 109.7h22.4V20.3H99.8v89.4zM477.5 20.3h-33.2v37.6l22.1 20V41.4h11.8c7.5.0 11.2 3.7 11.2 9.5v27.9c0 5.8-3.5 9.7-11.2 9.7h-34v21.2h33.2c17.8.1 34.5-8.8 34.5-29.4V50.2C512 29.4 495.3 20.3 477.5 20.3zM314.6 19c-18.4.0-36.7 10.1-36.7 30.7v30.6c0 20.5 18.4 30.7 36.9 30.7 18.4.0 36.7-10.2 36.7-30.7V49.7C351.5 29.2 333 19 314.6 19zM329 80.3c0 6.4-7.2 9.7-14.3 9.7-7.2.0-14.4-3.2-14.4-9.7V49.7c0-6.6 7-10.1 14-10.1 7.3.0 14.7 3.2 14.7 10.1V80.3zM431.8 49.7c-.5-21-14.7-29.4-33-29.4h-35.5v89.5H386V81.3h4l20.6 28.4h28L414.4 79C425.2 75.6 431.8 66.3 431.8 49.7zM399.2 61.8H386V41.4h13.2c14.2.0 14.2 20.4.0 20.4z"/></svg></a></div><div class=discord-dialog__close-button onclick='document.querySelector(".discord-dialog").className="discord-dialog"'><svg viewBox="0 0 24 24"><path fill="#000" d="M13.46 12 19 17.54V19H17.54L12 13.46 6.46 19H5V17.54L10.54 12 5 6.46V5H6.46L12 10.54 17.54 5H19V6.46L13.46 12z"/></svg></div><div class=discord-dialog__container><div class=discord-dialog__guild>You're invited to join my Discord server</div>This is a chat server where I hang out, discuss my projects and sometimes screencast as I work on them.<br><br>Feel free to hop in, talk about your own projects, share your thoughts:
<b>this is a virtual coworking room for anyone to join</b>.</div><div class=discord-dialog__footer><a href=https://discord.gg/YC6j4rbvSk class=discord-dialog__btn>Join the server now</a></div></div></html>